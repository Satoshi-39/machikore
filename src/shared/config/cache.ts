/**
 * キャッシュ設定
 *
 * TanStack Query と永続化の設定値
 */

// ===============================
// 静的データのキャッシュ設定
// ===============================

/**
 * 静的データ（交通機関、街、市区町村）のキャッシュ設定
 *
 * - staleTime: データの鮮度期間（この間は再取得しない）
 * - gcTime: メモリキャッシュの保持期間（この後メモリから解放）
 * - maxAge: 永続化データの保存期限（AsyncStorageでの保存期間）
 */
export const STATIC_DATA_CACHE_CONFIG = {
  /** データの鮮度（30日） - この間は再取得しない */
  staleTime: 30 * 24 * 60 * 60 * 1000,
  /** メモリキャッシュ保持時間（5分） - この後メモリから解放、永続化には残る */
  gcTime: 5 * 60 * 1000,
  /** 永続化の保存期限（30日） - AsyncStorageでの保存期間 */
  maxAge: 30 * 24 * 60 * 60 * 1000,
} as const;

// ===============================
// LRUキャッシュ設定
// ===============================

/**
 * LRUキャッシュの上限設定
 *
 * 各データ種別ごとにメモリに保持する最大エントリ数を定義
 * 上限を超えた場合、最も古くアクセスされたものから削除
 *
 * Note:
 * - transport-hubsは動的に多くの場所を見るため、LRU管理対象外
 *   （gcTimeで自動的にメモリから解放される）
 * - machi/citiesはデフォルトマップでのみ表示されるため、LRU管理対象
 */
export const LRU_CACHE_LIMITS = {
  /** 街データ: 最大5都道府県分 */
  machi: 5,
  /** 市区町村データ: 最大5都道府県分 */
  cities: 5,
} as const;

// ===============================
// 動的データのキャッシュ設定
// ===============================

/**
 * 動的データ（ユーザー生成コンテンツ）のキャッシュ設定
 */
export const DYNAMIC_DATA_CACHE_CONFIG = {
  /** データの鮮度（5分） */
  staleTime: 5 * 60 * 1000,
  /** メモリキャッシュ保持時間（10分） */
  gcTime: 10 * 60 * 1000,
} as const;

// ===============================
// 永続化設定
// ===============================

/**
 * 永続化のストレージキー
 */
export const PERSISTER_STORAGE_KEY = 'MACHIKORE_QUERY_CACHE';

/**
 * 永続化対象のクエリキープレフィックス
 *
 * これらのプレフィックスを持つクエリのみAsyncStorageに永続化
 *
 * Note:
 * - machi/citiesはSQLiteでキャッシュするため対象外
 * - transport-hubsは動的に多くの場所を見るため対象外（メモリキャッシュのみ）
 */
export const PERSISTED_QUERY_PREFIXES = ['prefectures'] as const;
